<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Esports club Sign-up</title>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"
          integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.css" />
    <link rel="stylesheet" href="Sinup_styles.css">
</head>

<body>
    <div class="container">
        <h1 class="brand"><span>Esports</span> Clubs</h1>
        <div class="wrapper">
            <div class="Playername-info">
                <h3>Esports club Sign-up</h3>
                <ul>
                    <li><i class="fa fa-road"></i> 4344 Something st</li>
                    <li><i class="fa fa-roles"></i> (555) 555-5555</li>
                    <li><i class="fa fa-envelope"></i> test@sportsclub.test</li>
                </ul>
            </div>
            <div class="contact">
                <h3>Sign-up</h3>
                <div class="alert">Submitted</div>
                <form id="contactForm" onsubmit="return false;">
                    <p>
                        <label>Name</label>
                        <input type="text" name="name" value="" id="name" required>
                    </p>
                    <p>
                        <label>Playername/ Username</label>
                        <input type="text" name="Playername" value="" id="Playername">
                    </p>
                    <p>
                        <label>Team name</label>
                        <input type="text" name="team" value="" id="team" required>
                    </p>
                    <p>
                        <label>Roles</label>
                        <input type="text" name="roles" value="" id="roles">
                    </p>
                    <p class="full">
                        <label>Description</label>
                        <textarea name="description" rows="5" id="description"></textarea>
                    </p>
                    <p class="full">
                    <p>Click on the "Choose File" button to upload a picture:</p>


                    <input type="file" id="myFile" accept="image/*" name="filename">

                    <button id="saveBtn" type="submit">Submit</button>

                </form>
            </div>
        </div>
    </div>
    <script type="module">

        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.0.1/firebase-analytics.js";
        import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/9.0.1/firebase-firestore.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        var firebaseConfig = {
    apiKey: "AIzaSyAqokPjgpp4dcdwZmXNRBXdaYvayaGGpyg",
    authDomain: "senior-project-4f3bb.firebaseapp.com",
    databaseURL: "https://senior-project-4f3bb-default-rtdb.firebaseio.com",
    projectId: "senior-project-4f3bb",
    storageBucket: "senior-project-4f3bb.appspot.com",
    messagingSenderId: "160860532291",
    appId: "1:160860532291:web:01005a9de5c82beb162ef6",
    measurementId: "G-0BDYPJ0YY4"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);

        document.getElementById('contactForm').addEventListener('submit', submitForm);
        async function submitForm(e) {
            e.preventDefault();


            var name = getInputVal('name');
            var Playername = getInputVal('Playername');
            var team = getInputVal('team');
            var roles = getInputVal('roles');
            var description = getInputVal('description');
            const file = document.getElementById('myFile').files[0];
            var imageStr = await toBase64(file);
            if (!imageStr)
                imageStr = "";
            savebiography(name, Playername, team, roles, description, imageStr);
            document.querySelector('.alert').style.display = 'block';
            setTimeout(function () {
                document.querySelector('.alert').style.display = 'none';
            }, 3000);
            document.getElementById('contactForm').reset();
        }

        const toBase64 = file => new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });


        async function savebiography(name, Playername, team, roles, description,image) {
            try {
                const docRef = await addDoc(collection(db, "SportsClub"), {
                    name: name,
                    Playername: Playername,
                    team: team,
                    roles: roles,
                    description: description,
                    image: image
                });
                location.replace("./esportSignup.html")
                console.log("Document written with ID: ", docRef.id);
            } catch (e) {
                console.error("Error adding document: ", e);
            }
        }

        function getInputVal(id) {
            console.log(id);
            return document.getElementById(id).value;
        }
    </script>
</body>

</html>
